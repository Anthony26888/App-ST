services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: /api   # truyền vào build
        VITE_EMAILJS_SERVICE_ID: ${VITE_EMAILJS_SERVICE_ID}
        VITE_EMAILJS_TEMPLATE_ID: ${VITE_EMAILJS_TEMPLATE_ID}
        VITE_EMAILJS_PUBLIC_KEY: ${VITE_EMAILJS_PUBLIC_KEY}
        VITE_DIGIKEY_CLIENT_ID: ${VITE_DIGIKEY_CLIENT_ID}
        VITE_DIGIKEY_CLIENT_SECRET: ${VITE_DIGIKEY_CLIENT_SECRET}
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - app-network
    env_file:
      - ./.env

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
    env_file:
      - ./.env
    volumes:
      - ./backend:/app
      - /app/node_modules
    networks:
      - app-network

networks:
  app-network:
    driver: bridge


# version: "3.8"

# services:
#   nginx-proxy:
#     image: jwilder/nginx-proxy
#     ports:
#       - "80:80"
#       - "443:443"
#     volumes:
#       - /var/run/docker.sock:/tmp/docker.sock:ro
#       - ./certs:/etc/nginx/certs:ro
#       - ./vhost.d:/etc/nginx/vhost.d
#       - ./html:/usr/share/nginx/html
#     networks:
#       - app-network

#   letsencrypt:
#     image: jrcs/letsencrypt-nginx-proxy-companion
#     environment:
#       - NGINX_PROXY_CONTAINER=nginx-proxy
#       - DEFAULT_EMAIL=you@example.com
#     volumes_from:
#       - nginx-proxy
#     volumes:
#       - /var/run/docker.sock:/var/run/docker.sock:ro
#       - ./certs:/etc/nginx/certs:rw
#       - ./vhost.d:/etc/nginx/vhost.d
#       - ./html:/usr/share/nginx/html
#     networks:
#       - app-network

#   frontend:
#     build:
#       context: ./frontend
#       dockerfile: Dockerfile
#       args:
#         VITE_API_URL: /api
#     expose:
#       - "80"
#     environment:
#       - VIRTUAL_HOST=erp.sieuthuat.com
#       - LETSENCRYPT_HOST=erp.sieuthuat.com
#       - LETSENCRYPT_EMAIL=you@example.com
#     networks:
#       - app-network
#     depends_on:
#       - backend

#   backend:
#     build:
#       context: ./backend
#       dockerfile: Dockerfile
#     expose:
#       - "3000"
#     environment:
#       - VIRTUAL_HOST=erp.sieuthuat.com
#       - VIRTUAL_PATH=/api
#       - LETSENCRYPT_HOST=erp.sieuthuat.com
#       - LETSENCRYPT_EMAIL=you@example.com
#     networks:
#       - app-network

# networks:
#   app-network:
#     driver: bridge
